# ABCDE Configuration for Offline Operation (No Internet Required)
# This config works without internet connectivity

# CD device
CDROM=/dev/sr0

# Output directory
OUTPUTDIR="/mnt/MUSIC"

# Output type and quality
OUTPUTTYPE="flac,mp3"
FLACENCODERSYNTAX=flac
FLACOPTS='--verify --best'
MP3ENCODERSYNTAX=lame
LAMEOPTS='-V0 --vbr-new'

# Actions to perform - include tagging for proper metadata
ACTIONS=read,encode,tag,move,clean

# Non-interactive mode
INTERACTIVE=n

# Use cdparanoia for better error correction
CDROMREADERSYNTAX=cdparanoia            
CDPARANOIA=cdparanoia  
CDPARANOIAOPTS="--never-skip=40"

# Don't eject automatically (we handle ejection in Python)
EJECTCD=n

# Padding for track numbers
PADTRACKS=y
OUTPUTFORMAT='${DARTIST}/${DALBUM}/${TRACKNUM} - Track_${TRACKNUM}'

# Skip CDDB/MusicBrainz entirely - comment out instead of using 'none'
# CDDBMETHOD=

# Better default metadata when no internet available
DARTIST="CD_Ripped_$(date +%Y%m%d)"
DALBUM="Album_$(date +%Y%m%d_%H%M)"
DYEAR=$(date +%Y)
DGENRE="Unknown"

# Function to set better defaults
pre_read() {
    # Try to get disc ID for better naming
    if command -v cd-discid >/dev/null; then
        DISCID=$(cd-discid $CDROM 2>/dev/null | awk '{print $1}')
        if [ -n "$DISCID" ]; then
            DARTIST="CD_${DISCID}"
            DALBUM="Disc_${DISCID}_$(date +%Y%m%d)"
            echo "$(date): Using disc ID $DISCID for naming" >> ~/.abcde.log
        fi
    fi
}

# Character translations for safe filenames
mungefilename ()
{
    echo "$@" | sed -e 's/^\.*//' -e 's/[^A-Za-z0-9._-]/_/g' -e 's/__*/_/g' -e 's/_$//g' -e 's/^_//g'
}

# Pre and post encode functions (use home directory for logs)
pre_read ()
{
    echo "$(date): Starting offline rip (no metadata lookup)" >> ~/.abcde.log
}

post_encode ()
{
    echo "$(date): Completed offline rip: $OUTPUTDIR/$DARTIST/$DALBUM" >> ~/.abcde.log
}

# Encoding threads
MAXPROCS=2
